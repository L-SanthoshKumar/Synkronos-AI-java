version: '3.8'

services:
  mongodb:
    image: mongo:7.0
    container_name: synkronos-mongodb
    restart: unless-stopped
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_DATABASE: synkronos_db
    volumes:
      - mongodb_data:/data/db
    networks:
      - synkronos-network

  backend-java:
    build:
      context: ./backend-java
      dockerfile: Dockerfile
    container_name: synkronos-backend
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      MONGODB_URI: mongodb://mongodb:27017/synkronos_db
      JWT_SECRET: ${JWT_SECRET:-SynkronosAISecretKeyForJWTTokenGeneration2024Production}
      JWT_EXPIRATION: ${JWT_EXPIRATION:-86400000}
      JWT_REFRESH_EXPIRATION: ${JWT_REFRESH_EXPIRATION:-604800000}
      CLOUDINARY_CLOUD_NAME: ${CLOUDINARY_CLOUD_NAME:-}
      CLOUDINARY_API_KEY: ${CLOUDINARY_API_KEY:-}
      CLOUDINARY_API_SECRET: ${CLOUDINARY_API_SECRET:-}
      ML_SERVICE_URL: http://ml-engine:5000
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:5173,http://localhost:3000}
    depends_on:
      - mongodb
      - ml-engine
    networks:
      - synkronos-network

  ml-engine:
    build:
      context: ./ml-engine
      dockerfile: Dockerfile
    container_name: synkronos-ml-engine
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      PORT: 5000
      FLASK_DEBUG: ${FLASK_DEBUG:-False}
    networks:
      - synkronos-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: synkronos-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend-java
    networks:
      - synkronos-network

volumes:
  mongodb_data:

networks:
  synkronos-network:
    driver: bridge

